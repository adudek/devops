#!/bin/bash -eu

mysql_cmd="${MYSQL_CMD:-mysql --host=127.0.0.1 --user=root --password=root}"

${mysql_cmd} -e "CREATE USER 'nvm'@'%'" || true
${mysql_cmd} -e "GRANT ALL ON nvm.* TO 'nvm' IDENTIFIED BY 'pass'"
${mysql_cmd} -e 'CREATE DATABASE IF NOT EXISTS nvm'

${mysql_cmd} -Dnvm -e '
  CREATE TABLE IF NOT EXISTS DataStructure(
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Address VARCHAR(255) NOT NULL,
    TelephoneNo VARCHAR(22) NOT NULL
  );
'

i=${1:-10}
while [[ $(( i-- )) -gt 0 ]]; do
  echo "Inserting records: ${i} * 100"
  ${mysql_cmd} -Dnvm -e "
    $(jq -r .content <(curl -s 'https://www.generatedata.com/ajax.php' -H 'Content-Type: application/x-www-form-urlencoded;charset=UTF-8' -H 'Accept: application/json; q=0.01' -H 'Connection: keep-alive' -H 'DNT: 1' --data $'gdRowOrder=1%2C2%2C3&gdExportType=SQL&gdNumCols=4&gdExportFormat=&configurationID=&gdCountries%5B%5D=poland&gdTitle_1=Name&gdDataType_1=data-type-Names&dtExample_1=Surname%2C+Name+Initial.&dtOption_1=Surname%2C+Name+Initial.&gdTitle_2=Address&gdDataType_2=data-type-StreetAddress&gdTitle_3=TelephoneNo&gdDataType_3=data-type-PersonalNumber&dtExample_3=PersonalNumberWithoutHyphen&dtOptionPersonalNumber_sep_3=&gdNumRowsToAdd=1&etCSV_delimiter=%7C&etCSV_lineEndings=Windows&etHTMLExportFormat=table&etHTMLCustomHTMLSource=%7Bif+%24isFirstBatch%7D%0D%0A%3C\u0021DOCTYPE+html%3E%0D%0A%3Chtml%3E%0D%0A%3Chead%3E%0D%0A%09%3Cmeta+charset%3D%22utf-8%22%3E%0D%0A%09%3Cstyle+type%3D%22text%2Fcss%22%3E%0D%0A%09body+%7B+margin%3A+10px%3B+%7D%0D%0A%09table%2C+th%2C+td%2C+li%2C+dl+%7B+font-family%3A+%22lucida+grande%22%2C+arial%3B+font-size%3A+8pt%3B+%7D%0D%0A%09dt+%7B+font-weight%3A+bold%3B+%7D%0D%0A%09table+%7B+background-color%3A+%23efefef%3B+border%3A+2px+solid+%23dddddd%3B+width%3A+100%25%3B+%7D%0D%0A%09th+%7B+background-color%3A+%23efefef%3B+%7D%0D%0A%09td+%7B+background-color%3A+%23ffffff%3B+%7D%0D%0A%09%3C%2Fstyle%3E%0D%0A%3C%2Fhead%3E%0D%0A%3Cbody%3E%0D%0A%0D%0A%3Ctable+cellspacing%3D%220%22+cellpadding%3D%221%22%3E%0D%0A%3Ctr%3E%0D%0A%7Bforeach+%24colData+as+%24col%7D%0D%0A%09%3Cth%3E%7B%24col%7D%3C%2Fth%3E%0D%0A%7B%2Fforeach%7D%0D%0A%3C%2Ftr%3E%0D%0A%7B%2Fif%7D%0D%0A%7Bforeach+%24rowData+as+%24row%7D%0D%0A%3Ctr%3E%0D%0A%7Bforeach+%24row+as+%24r%7D%09%3Ctd%3E%7B%24r%7D%3C%2Ftd%3E%0D%0A%7B%2Fforeach%7D%0D%0A%3C%2Ftr%3E%0D%0A%7B%2Fforeach%7D%0D%0A%0D%0A%7Bif+%24isLastBatch%7D%0D%0A%3C%2Ftable%3E%0D%0A%0D%0A%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E%0D%0A%7B%2Fif%7D&etHTMLCustomSmarty=%7Bif+%24isFirstBatch%7D%0D%0A%3C\u0021DOCTYPE+html%3E%0D%0A%3Chtml%3E%0D%0A%3Chead%3E%0D%0A%09%3Cmeta+charset%3D%22utf-8%22%3E%0D%0A%09%3Cstyle+type%3D%22text%2Fcss%22%3E%0D%0A%09body+%7B+margin%3A+10px%3B+%7D%0D%0A%09table%2C+th%2C+td%2C+li%2C+dl+%7B+font-family%3A+%22lucida+grande%22%2C+arial%3B+font-size%3A+8pt%3B+%7D%0D%0A%09dt+%7B+font-weight%3A+bold%3B+%7D%0D%0A%09table+%7B+background-color%3A+%23efefef%3B+border%3A+2px+solid+%23dddddd%3B+width%3A+100%25%3B+%7D%0D%0A%09th+%7B+background-color%3A+%23efefef%3B+%7D%0D%0A%09td+%7B+background-color%3A+%23ffffff%3B+%7D%0D%0A%09%3C%2Fstyle%3E%0D%0A%3C%2Fhead%3E%0D%0A%3Cbody%3E%0D%0A%0D%0A%3Ctable+cellspacing%3D%220%22+cellpadding%3D%221%22%3E%0D%0A%3Ctr%3E%0D%0A%7Bforeach+%24colData+as+%24col%7D%0D%0A%09%3Cth%3E%7B%24col%7D%3C%2Fth%3E%0D%0A%7B%2Fforeach%7D%0D%0A%3C%2Ftr%3E%0D%0A%7B%2Fif%7D%0D%0A%7Bforeach+%24rowData+as+%24row%7D%0D%0A%3Ctr%3E%0D%0A%7Bforeach+%24row+as+%24r%7D%09%3Ctd%3E%7B%24r%7D%3C%2Ftd%3E%0D%0A%7B%2Fforeach%7D%0D%0A%3C%2Ftr%3E%0D%0A%7B%2Fforeach%7D%0D%0A%0D%0A%7Bif+%24isLastBatch%7D%0D%0A%3C%2Ftable%3E%0D%0A%0D%0A%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E%0D%0A%7B%2Fif%7D&etJSON_dataStructureFormat=complex&etProgrammingLanguage_language=JavaScript&etSQL_tableName=DataStructure&etSQL_databaseType=MySQL&etSQL_encloseWithBackquotes=on&etSQL_statementType=insert&etSQL_insertBatchSize=100&etSQL_primaryKey=none&etXMLRootNodeName=records&etXMLRecordNodeName=record&etXMLCustomHTMLSource=%7Bif+%24isFirstBatch%7D%0D%0A%3C%3Fxml+version%3D%221.0%22+encoding%3D%22UTF-8%22+%3F%3E%0D%0A%3Crecords%3E%0D%0A%7B%2Fif%7D%0D%0A%7Bforeach+%24rowData+as+%24row%7D%0D%0A%09%3Crecord%3E%0D%0A%7Bforeach+from%3D%24colData+item%3Dcol+name%3Dc%7D%0D%0A%09%09%3C%7B%24col%7D%3E%7B%24row%5B%24smarty.foreach.c.index%5D%7D%3C%2F%7B%24col%7D%3E%0D%0A%7B%2Fforeach%7D%0D%0A%09%3C%2Frecord%3E%0D%0A%7B%2Fforeach%7D%0D%0A%7Bif+%24isLastBatch%7D%0D%0A%3C%2Frecords%3E%0D%0A%7B%2Fif%7D&etXMLCustomSmarty=%7Bif+%24isFirstBatch%7D%0D%0A%3C%3Fxml+version%3D%221.0%22+encoding%3D%22UTF-8%22+%3F%3E%0D%0A%3Crecords%3E%0D%0A%7B%2Fif%7D%0D%0A%7Bforeach+%24rowData+as+%24row%7D%0D%0A%09%3Crecord%3E%0D%0A%7Bforeach+from%3D%24colData+item%3Dcol+name%3Dc%7D%0D%0A%09%09%3C%7B%24col%7D%3E%7B%24row%5B%24smarty.foreach.c.index%5D%7D%3C%2F%7B%24col%7D%3E%0D%0A%7B%2Fforeach%7D%0D%0A%09%3C%2Frecord%3E%0D%0A%7B%2Fforeach%7D%0D%0A%7Bif+%24isLastBatch%7D%0D%0A%3C%2Frecords%3E%0D%0A%7B%2Fif%7D&gdNumRowsToGenerate=100&gdExportTarget=inPage&action=generateInPage&gdBatchSize=100&gdCurrentBatchNum=1'))
  " &
done
